<% provide(:title, 'Sign up') %>
<h1 class="text-center">Sign up</h1>

<div class="row">
  <div class="col-md-6 col-md-offset-3">
    
  <%= link_to "Sign up", openjub_path, :class => "button", :method => :get, :target => "_blank" %>

  <script>
    var once = false;
  //get the callback from openJUB
    window.addEventListener("message", receiveMessage, false);

    function post(data) {

      $.ajax({
        url: "/users",
        type: "POST",
        data: JSON.parse(data),
        success: function(){console.log("submitted")}
      });

    }

    function receiveMessage(event) {
      if(!once) {
        once = true;
        console.log(event);
        post(event.data);
        console.log("posted");
      }
    }

  </script>

  </div>
</div>